<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>银行管理系统接口测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        form { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        label { display: block; margin-bottom: 5px; }
        input { padding: 5px; margin-bottom: 10px; width: 250px; }
        button { padding: 5px 10px; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>

<h1>用户注册</h1>
<form id="registerForm">
    <label>用户名: <input type="text" name="username" required></label>
    <label>密码: <input type="password" name="password" required></label>
    <label>姓名: <input type="text" name="name" required></label>
    <label>身份证: <input type="text" name="idCard" required></label>
    <label>手机号: <input type="text" name="phone" required></label>
    <label>邮箱: <input type="email" name="email" required></label>
    <button type="submit">注册</button>
</form>

<h1>用户登录</h1>
<form id="loginForm">
    <label>用户名: <input type="text" name="username" required></label>
    <label>密码: <input type="password" name="password" required></label>
    <button type="submit">登录</button>
</form>

<h1>获取用户信息</h1>
<form id="getUserForm">
    <label>用户ID: <input type="number" name="id" required></label>
    <button type="submit">获取</button>
</form>

<pre id="result"></pre>

<script>
    const apiBase = 'http://localhost:8080/api/users'; // 后端接口地址
    const resultEl = document.getElementById('result');

    // 注册
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const data = {
            username: form.username.value,
            password: form.password.value,
            name: form.name.value,
            idCard: form.idCard.value, // DTO字段名
            phone: form.phone.value,
            email: form.email.value
        };
        try {
            const res = await fetch(`${apiBase}/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            if (!res.ok) {
                const err = await res.json();
                throw new Error(JSON.stringify(err));
            }
            const json = await res.json();
            resultEl.textContent = '注册成功:\n' + JSON.stringify(json, null, 2);
        } catch (err) {
            resultEl.textContent = '注册失败:\n' + err;
        }
    });

    // 登录
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const data = {
            username: form.username.value,
            password: form.password.value
        };
        try {
            const res = await fetch(`${apiBase}/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            if (!res.ok) {
                const err = await res.json();
                throw new Error(JSON.stringify(err));
            }
            const token = await res.text(); // 返回JWT字符串
            localStorage.setItem('token', token);
            resultEl.textContent = '登录成功，JWT:\n' + token;
        } catch (err) {
            resultEl.textContent = '登录失败:\n' + err;
        }
    });

    // 获取用户信息
    document.getElementById('getUserForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const form = e.target;
        const id = form.id.value;
        try {
            const res = await fetch(`${apiBase}/${id}`, {
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                }
            });
            if (!res.ok) {
                const err = await res.json();
                throw new Error(JSON.stringify(err));
            }
            const json = await res.json();
            resultEl.textContent = '用户信息:\n' + JSON.stringify(json, null, 2);
        } catch (err) {
            resultEl.textContent = '获取失败:\n' + err;
        }
    });
</script>

</body>
</html>
